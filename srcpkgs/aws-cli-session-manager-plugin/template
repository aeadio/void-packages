# Template file for 'aws-cli-session-manager-plugin'
pkgname=aws-cli-session-manager-plugin
version=1.2.30.0
revision=1
archs="i686 x86_64 aarch64"
hostmakedepends="tar"
depends="aws-cli"
short_desc="Session Manager plugin for aws-cli"
maintainer="Anthony Eadicicco <void@aead.io>"
license="custom:Proprietary"
homepage="https://docs.aws.amazon.com/systems-manager/latest/userguide/session-manager-working-with-install-plugin.html"
restricted=yes
repository="nonfree"
nostrip=yes

case "${XBPS_TARGET_MACHINE}" in
	x86_64)
		_ubarch=ubuntu_64bit
		checksum=27f01987ed2977480c1ff322e0889270a3b8df43097f71e2667827e745e8bbba
		;;
	i686)
		_ubarch=ubuntu_32bit
		checksum=428e1f8b1114f7dcd2b33028dd2484b0089d1746463a3fec65c1ffebd1120d9e
		;;
	aarch64)
		_ubarch=ubuntu_arm64
		checksum=dddd35f810d6d4461d032f1ade48ab95dc10c06b7e5d15c533800d0a26293ec4
		;;
esac

distfiles="https://s3.amazonaws.com/session-manager-downloads/plugin/${version}/${_ubarch}/session-manager-plugin.deb"

do_extract() {
	ar x ${XBPS_SRCDISTDIR}/${pkgname}-${version}/session-manager-plugin.deb
	tar xf data.tar.gz
}

do_install() {
	vlicense usr/local/sessionmanagerplugin/LICENSE
	vcopy usr/local/sessionmanagerplugin usr/lib
	vmkdir usr/bin
	ln -s /usr/lib/sessionmanagerplugin/bin/session-manager-plugin ${DESTDIR}/usr/bin/session-manager-plugin
}
